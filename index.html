<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaze-Controlled Letter Selector</title>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/tracking.js/1.1.3/tracking-min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/webgazer/2.0.1/webgazer.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: black;
            overflow: hidden;
            flex-direction: column;
            color: white;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(6, 100px);
            grid-gap: 50px; /* Increased spacing */
            text-align: center;
        }
        .letter {
            font-size: 32px;
            font-weight: bold;
            padding: 20px;
            border: 2px solid white;
            width: 80px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>Gaze at a Letter & Blink to Select</h1>
    <div class="grid" id="letterGrid"></div>

    <script>
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
        const grid = document.getElementById("letterGrid");
        let selectedLetter = null;
        let lastBlinkTime = 0;

        // Create grid of letters
        letters.forEach(letter => {
            const div = document.createElement("div");
            div.classList.add("letter");
            div.textContent = letter;
            div.id = `letter-${letter}`;
            grid.appendChild(div);
        });

        // Start webgazer for eye tracking
        webgazer.setGazeListener((data, elapsedTime) => {
            if (data) {
                const x = data.x;
                const y = data.y;
                let hoveredElement = document.elementFromPoint(x, y);
                
                if (hoveredElement && hoveredElement.classList.contains("letter")) {
                    selectedLetter = hoveredElement;
                }
            }
        }).begin();

        // Blink detection
        navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
            let video = document.createElement("video");
            video.srcObject = stream;
            video.play();
            document.body.appendChild(video);
            
            let tracker = new tracking.ObjectTracker("eye");
            tracker.setInitialScale(4);
            tracker.setStepSize(2);
            tracker.setEdgesDensity(0.1);
            tracking.track(video, tracker);

            tracker.on("track", event => {
                if (event.data.length === 0) {
                    let now = new Date().getTime();
                    if (now - lastBlinkTime > 800) { // Blink detection cooldown
                        lastBlinkTime = now;
                        if (selectedLetter) {
                            speakLetter(selectedLetter.textContent);
                        }
                    }
                }
            });
        }).catch(error => console.error("Camera access denied", error));

        // Speech synthesis function
        function speakLetter(letter) {
            let msg = new SpeechSynthesisUtterance(letter);
            window.speechSynthesis.speak(msg);
        }
    </script>

</body>
</html>